<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add new hike</title>
</head>
<body>
<p>Add new hike</p>
<form method="post" th:action="@{/hiking/submit}">
    <div>
        <label>Date</label>
        <textarea name="date"></textarea>
    </div>
    <div>
        <label>Duration</label>
        <textarea name="duration"></textarea>
    </div>
    <div>

        <label for="waypoint1">Wybierz pierwszy Waypoint:</label><br>
        <select id="waypoint1" name="waypoint1" onchange="pobierzDostepneSciezki(this)">
            <option th:each="waypoint : ${allWaypoints}" th:value="${waypoint.name}" th:text="${waypoint.name}"></option>
        </select><br>
    </div>
    <div>

        <label for="waypoint1">Wybierz drugi Waypoint:</label><br>
        <select id="waypoint2" name="waypoint2" onchange="pobierzDostepneSciezki(this)">
            <option th:each="waypoint : ${allWaypoints}" th:value="${waypoint.name}" th:text="${waypoint.name}"></option>
        </select><br>
    </div>
    <div id="waypoints-container">


    </div>
    <button type="button" onclick="dodajWaypoint()">Dodaj kolejny Waypoint</button>
    </div>
    <button type="submit">Submit :)</button>
    <div>

</form>












<script th:inline="javascript">
    var allWaypointsPaths = /*[[${allWaypointsPaths}]]*/;

    function pobierzDostepneSciezki(selectElement) {
        var selectedWaypoint= selectElement.options[selectElement.selectedIndex].text;

        console.log("Wybrany Waypoint:", selectedWaypoint);

        var sciezkiContainer = document.getElementById("waypoints-container");
        sciezkiContainer.innerHTML = '';

        var select = document.createElement("select");
        select.name = "sciezki";

        var availablePaths = mapData.get(selectedWaypoint);
        console.log("Dostępne ścieżki:", availablePaths);

        if (availablePaths && availablePaths.length > 0) {
            availablePaths.forEach(function (sciezka) {
                var option = document.createElement("option");
                option.value = sciezka;
                option.text = sciezka;
                select.appendChild(option);
            });
        } else {
            // Dodaj komunikat, gdy nie ma dostępnych ścieżek
            var option = document.createElement("option");
            option.text = "Brak dostępnych ścieżek";
            select.appendChild(option);
        }

        sciezkiContainer.appendChild(select);
    }

    function dodajWaypoint() {
        var waypointsContainer = document.getElementById("waypoints-container");
        if (!waypointsContainer) {
            waypointsContainer = document.createElement("div");
            waypointsContainer.id = "waypoints-container";
            document.getElementById("waypoints-form").appendChild(waypointsContainer);
        }

        var lastWaypointSelect = waypointsContainer.lastElementChild;

        var cloneSelect = lastWaypointSelect ? lastWaypointSelect.cloneNode(true) : document.getElementById("waypoint1").cloneNode(true);

        // Resetowanie wartości wybranego Waypointu
        cloneSelect.selectedIndex = 0;
        cloneSelect.onchange = function () {
            pobierzDostepneSciezki(cloneSelect);
        };

        waypointsContainer.appendChild(document.createElement("br"));
        waypointsContainer.appendChild(cloneSelect);
    }
</script>-->





































<!--

<form action="/przetwarzanie_danych" method="post" id="waypoints-form">
    <div>
        <label for="waypoint1">Wybierz pierwszy Waypoint:</label><br>
        <select id="waypoint1" name="waypoint1" onchange="pobierzDostepneSciezki(this)">
            &lt;!&ndash; Generowanie opcji z listy allWaypoints &ndash;&gt;
            <option th:each="waypoint : ${allWaypoints}" th:value="${waypoint}" th:text="${waypoint.name}"></option>
        </select><br>
    </div>
    <div id="sciezki-container">
        &lt;!&ndash; Tutaj dynamicznie generowane będzie drugie pole select dla availablePaths &ndash;&gt;
    </div>
    <button type="button" onclick="dodajWaypoint()">Dodaj kolejny Waypoint</button>
    <button type="submit" name="akcja" value="zakoncz">Zakończ</button>
</form>

<script>
    function pobierzDostepneSciezki(selectElement) {
        var selectedWaypoint = selectElement.value;
        var availablePaths = JSON.parse("[[${allWaypointsPaths}]]");
        var sciezkiContainer = document.getElementById("sciezki-container");
        sciezkiContainer.innerHTML = '';

        var select = document.createElement("select");
        select.name = "sciezki";

        availablePaths[selectedWaypoint].forEach(function (sciezka) {
            var option = document.createElement("option");
            option.value = sciezka;
            option.text = sciezka;
            select.appendChild(option);
        });

        sciezkiContainer.appendChild(select);
    }

    function dodajWaypoint() {
        // Kod dodawania kolejnego pola <select>
        // ... (został już wcześniej pokazany)
    }
</script>
-->


<!--
<form action="/przetwarzanie_danych" method="post" id="waypoints-form">
    <div id="waypoints-container">
        <label for="waypoints">Wybierz Waypoint:</label><br>
        <select name="waypoints">
            &lt;!&ndash; Generowanie opcji z listy allWaypoints &ndash;&gt;
            <option th:each="waypoint : ${allWaypoints}" th:value="${waypoint}" th:text="${waypoint.name}"></option>
        </select><br>
    </div>
    <button type="button" onclick="dodajWaypoint()">Dodaj kolejny Waypoint</button><br>
    <input type="submit" value="Wyślij">
</form>



<script>
    function dodajWaypoint() {
        var container = document.getElementById("waypoints-container");
        var select = document.createElement("select");
        select.name = "waypoints";

        // Dodaj opcje do nowego selecta (takie same jak w pierwszym select)
        var options = container.getElementsByTagName("select")[0].getElementsByTagName("option");
        for (var i = 0; i < options.length; i++) {
            var option = document.createElement("option");
            option.value = options[i].value;
            option.text = options[i].text;
            select.appendChild(option);
        }

        container.appendChild(select);
        container.appendChild(document.createElement("br"));
    }
</script>-->

</body>
</html>